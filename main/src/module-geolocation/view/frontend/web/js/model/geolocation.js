define(["jquery","mage/storage","Eloom_Core/js/model/url-builder","Eloom_Geolocation/js/model/here","Eloom_Geolocation/js/storage"],function(f,g,k,e,l){var c=null,d=null;return function(){if(window.eloom.geolocation.active){var h=k.createUrl("/eloom/geolocation/geocode",{});c=f.Deferred();try{if(navigator.geolocation)navigator.geolocation.getCurrentPosition(function(a){d=e.revgeocode(c,a.coords.latitude,a.coords.longitude)},function(a){return g.post(h,"").fail(function(b){console.log(b)}).success(function(b){b=
JSON.parse(b);"200"==b.code&&(d=e.revgeocode(c,b.data.lat,b.data.long))}).always(function(){})},{enableHighAccuracy:!0,timeout:5E3,maximumAge:0});else return g.post(h,"").fail(function(a){console.log(a)}).success(function(a){a=JSON.parse(a);"200"==a.code&&(d=e.revgeocode(c,a.data.lat,a.data.long))}).always(function(){})}catch(a){(console.error||console.log).call(console,a.message||a)}f.when(c).done(function(){try{if(d.responseJSON){var a=JSON.parse(d.responseJSON);a&&"200"==a.code&&l.setAddressData(a.data)}}catch(b){console.log(b)}}.bind(this)).fail(function(){}.bind(this)).always(function(){}.bind(this))}}});
